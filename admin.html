<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - CrossFit Competition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50">

<!-- PASSWORD MODAL -->
<div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
        <h2 class="text-2xl font-bold mb-4">üîí Acc√®s Administrateur</h2>
        <p class="text-gray-600 mb-4">Entrez le mot de passe pour acc√©der √† l'administration.</p>
        
        <input 
            type="password" 
            id="password-input" 
            class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 mb-4 focus:border-blue-500 focus:outline-none"
            placeholder="Mot de passe"
            autocomplete="off"
        >
        
        <button 
            id="login-btn"
            class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
        >
            Connexion
        </button>
        
        <p id="error-msg" class="text-red-600 text-sm mt-2 hidden">‚ùå Mot de passe incorrect</p>
        <p class="text-xs text-gray-400 mt-4">P–∞—Ä–æ–ª—å: admin123</p>
    </div>
</div>

<!-- MAIN CONTENT (hidden until logged in) -->
<div id="main-content" class="hidden">
    
    <!-- HEADER -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">üèãÔ∏è Administration</h1>
                <p class="text-sm text-gray-500">Gestion des tournois CrossFit</p>
            </div>
            <div class="flex gap-3">
                <a 
                    href="index.html"
                    class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition"
                >
                    üè† Accueil
                </a>
                <button 
                    id="logout-btn"
                    class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition"
                >
                    D√©connexion
                </button>
            </div>
        </div>
    </header>

    <!-- TABS NAVIGATION -->
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex space-x-8">
                <button 
                    class="tab-btn px-3 py-4 border-b-2 border-blue-600 font-medium text-blue-600"
                    data-tab="athletes"
                >
                    üë• Athl√®tes
                </button>
                <button 
                    class="tab-btn px-3 py-4 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                    data-tab="tournaments"
                >
                    üèÜ Tournois
                </button>
            </div>
        </div>
    </nav>

    <!-- TAB CONTENT -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- ATHLETES TAB -->
        <div id="tab-athletes" class="tab-content">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-2">Athl√®tes Globaux</h2>
                <p class="text-sm text-gray-600">Les athl√®tes sont partag√©s entre tous les tournois</p>
            </div>

            <!-- ADD ATHLETE FORM -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">‚ûï Ajouter un athl√®te</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <input 
                        type="text" 
                        id="athlete-firstname" 
                        placeholder="Pr√©nom" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                    <input 
                        type="text" 
                        id="athlete-lastname" 
                        placeholder="Nom" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                    <select 
                        id="athlete-gender" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                        <option value="M">Homme</option>
                        <option value="F">Femme</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <select 
                        id="athlete-level" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                        <option value="RX">RX</option>
                        <option value="INTER">INTER</option>
                        <option value="SCALE">SCALE</option>
                    </select>
                    <input 
                        type="text" 
                        id="athlete-team" 
                        placeholder="√âquipe (optionnel)" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                </div>

                <button 
                    id="add-athlete-btn"
                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold"
                >
                    Ajouter l'athl√®te
                </button>
            </div>

            <!-- ATHLETES LIST -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">üìã Liste des athl√®tes</h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Nom complet</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Niveau</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Genre</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">√âquipe</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="athletes-tbody" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-4 py-8 text-center text-gray-400">
                                    Chargement...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TOURNAMENTS TAB -->
        <div id="tab-tournaments" class="tab-content hidden">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-2">Gestion des Tournois</h2>
                <p class="text-sm text-gray-600">Cr√©ez et g√©rez les tournois et leurs WODs</p>
            </div>

            <!-- TOURNAMENT SELECTOR -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <select 
                        id="tournament-select" 
                        class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                        <option value="">Chargement...</option>
                    </select>
                    <button 
                        id="new-tournament-btn"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition font-semibold whitespace-nowrap"
                    >
                        ‚ûï Nouveau tournoi
                    </button>
                    <button 
                        id="refresh-btn"
                        class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition font-semibold"
                    >
                        üîÑ Actualiser
                    </button>
                </div>
            </div>

            <!-- ADD WOD FORM -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">‚ûï Ajouter un WOD</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input 
                        type="number" 
                        id="wod-number" 
                        min="1"
                        placeholder="Num√©ro du WOD (1, 2, 3...)" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                    <select 
                        id="wod-type" 
                        class="border border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"
                    >
                        <option value="time">‚è±Ô∏è For Time</option>
                        <option value="reps">üîÅ AMRAP</option>
                        <option value="weight">üèãÔ∏è Weight</option>
                        <option value="complex">üî• Complex</option>
                    </select>
                </div>

                <textarea 
                    id="wod-description" 
                    rows="3"
                    placeholder="Description du WOD (ex: 21-15-9 Thrusters & Pull-ups)" 
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-4 focus:border-blue-500 focus:outline-none"
                ></textarea>

                <button 
                    id="add-wod-btn"
                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold"
                >
                    Ajouter le WOD
                </button>
            </div>

            <!-- WODS LIST -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">üìã WODs du tournoi</h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">N¬∞</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Type</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Description</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="wods-tbody" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                                    S√©lectionnez un tournoi
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- RESULTS -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">üìä R√©sultats r√©cents</h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Athl√®te</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">WOD</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">R√©sultat</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="results-tbody" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                                    Aucun r√©sultat
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>
</div>

<!-- STATUS TOAST -->
<div id="status-toast" class="fixed bottom-4 right-4 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg hidden transition-opacity">
    <span id="status-text"></span>
</div>

<script>
// ==================== SUPABASE INIT ====================
const SUPABASE_URL = 'https://gbdanipvnqrggjjoebtn.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdiZGFuaXB2bnFyZ2dqam9lYnRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjYyNzUsImV4cCI6MjA4MDk0MjI3NX0.cRSuKatOSWgcbyhqAJ_5oWnENZK5sQZaZiGL15uytME';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

console.log('‚úÖ Supabase initialized');

// ==================== PASSWORD PROTECTION ====================
const ADMIN_PASSWORD = 'admin123';
let isLoggedIn = false;

const passwordModal = document.getElementById('password-modal');
const passwordInput = document.getElementById('password-input');
const loginBtn = document.getElementById('login-btn');
const errorMsg = document.getElementById('error-msg');
const mainContent = document.getElementById('main-content');
const logoutBtn = document.getElementById('logout-btn');

function checkLogin() {
    const password = passwordInput.value.trim();
    console.log('Checking password:', password); // Debug
    
    if (password === ADMIN_PASSWORD) {
        console.log('‚úÖ Password correct!');
        isLoggedIn = true;
        passwordModal.classList.add('hidden');
        mainContent.classList.remove('hidden');
        errorMsg.classList.add('hidden');
        init();
    } else {
        console.log('‚ùå Password incorrect');
        errorMsg.classList.remove('hidden');
        passwordInput.value = '';
        passwordInput.focus();
    }
}

loginBtn.addEventListener('click', checkLogin);
passwordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') checkLogin();
});

logoutBtn.addEventListener('click', () => {
    isLoggedIn = false;
    passwordModal.classList.remove('hidden');
    mainContent.classList.add('hidden');
    passwordInput.value = '';
    errorMsg.classList.add('hidden');
});

// ==================== UTILITY FUNCTIONS ====================
function showStatus(message, duration = 2500) {
    const toast = document.getElementById('status-toast');
    const text = document.getElementById('status-text');
    text.textContent = message;
    toast.classList.remove('hidden');
    setTimeout(() => toast.classList.add('hidden'), duration);
}

// ==================== TAB SWITCHING ====================
const tabBtns = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        const targetTab = btn.dataset.tab;
        
        // Update button styles
        tabBtns.forEach(b => {
            b.classList.remove('border-blue-600', 'text-blue-600');
            b.classList.add('border-transparent', 'text-gray-500');
        });
        btn.classList.remove('border-transparent', 'text-gray-500');
        btn.classList.add('border-blue-600', 'text-blue-600');
        
        // Update tab content
        tabContents.forEach(content => content.classList.add('hidden'));
        document.getElementById(`tab-${targetTab}`).classList.remove('hidden');
    });
});

// ==================== GLOBAL STATE ====================
let currentTournamentId = null;
let athletes = [];
let tournaments = [];
let wods = [];
let scores = [];

// ==================== DATE FORMATTING ====================
function formatDate(dateStr) {
    if (!dateStr) return '-';
    const d = new Date(dateStr);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const year = d.getFullYear();
    return `${day}/${month}/${year}`;
}

// ==================== ATHLETES ====================
async function loadAthletes() {
    try {
        const { data, error } = await supabase
            .from('athletes')
            .select('*')
            .order('last_name');
        
        if (error) throw error;
        
        athletes = data;
        renderAthletes();
    } catch (error) {
        console.error('Error loading athletes:', error);
        showStatus('‚ùå Erreur de chargement des athl√®tes');
    }
}

function renderAthletes() {
    const tbody = document.getElementById('athletes-tbody');
    
    if (!athletes.length) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" class="px-4 py-8 text-center text-gray-400">
                    Aucun athl√®te. Ajoutez-en un ci-dessus!
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = athletes.map(athlete => `
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">${athlete.first_name} ${athlete.last_name}</td>
            <td class="px-4 py-3">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                    ${athlete.level === 'RX' ? 'bg-purple-100 text-purple-800' : 
                      athlete.level === 'INTER' ? 'bg-blue-100 text-blue-800' : 
                      'bg-green-100 text-green-800'}">
                    ${athlete.level}
                </span>
            </td>
            <td class="px-4 py-3">${athlete.gender === 'M' ? 'üë® Homme' : 'üë© Femme'}</td>
            <td class="px-4 py-3">${athlete.team || '-'}</td>
            <td class="px-4 py-3 text-center">
                <button 
                    onclick="deleteAthlete(${athlete.id})"
                    class="text-red-600 hover:text-red-800 font-medium"
                >
                    üóëÔ∏è Supprimer
                </button>
            </td>
        </tr>
    `).join('');
}

document.getElementById('add-athlete-btn').addEventListener('click', async () => {
    const firstname = document.getElementById('athlete-firstname').value.trim();
    const lastname = document.getElementById('athlete-lastname').value.trim();
    const gender = document.getElementById('athlete-gender').value;
    const level = document.getElementById('athlete-level').value;
    const team = document.getElementById('athlete-team').value.trim();
    
    if (!firstname || !lastname) {
        alert('‚ö†Ô∏è Le pr√©nom et le nom sont obligatoires');
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('athletes')
            .insert({
                first_name: firstname,
                last_name: lastname,
                gender,
                level,
                team: team || null
            })
            .select()
            .single();
        
        if (error) throw error;
        
        showStatus('‚úÖ Athl√®te ajout√© avec succ√®s');
        
        // Clear form
        document.getElementById('athlete-firstname').value = '';
        document.getElementById('athlete-lastname').value = '';
        document.getElementById('athlete-team').value = '';
        
        await loadAthletes();
    } catch (error) {
        console.error('Error adding athlete:', error);
        showStatus('‚ùå Erreur lors de l\'ajout');
    }
});

async function deleteAthlete(id) {
    if (!confirm('Voulez-vous vraiment supprimer cet athl√®te ?')) return;
    
    try {
        const { error } = await supabase
            .from('athletes')
            .delete()
            .eq('id', id);
        
        if (error) throw error;
        
        showStatus('‚úÖ Athl√®te supprim√©');
        await loadAthletes();
    } catch (error) {
        console.error('Error deleting athlete:', error);
        showStatus('‚ùå Erreur lors de la suppression');
    }
}

// ==================== TOURNAMENTS ====================
async function loadTournaments() {
    try {
        const { data, error } = await supabase
            .from('tournaments')
            .select('*')
            .order('date_start', { ascending: false });
        
        if (error) throw error;
        
        tournaments = data;
        renderTournamentSelect();
        
        if (tournaments.length > 0 && !currentTournamentId) {
            currentTournamentId = tournaments[0].id;
            document.getElementById('tournament-select').value = currentTournamentId;
            await loadTournamentData();
        }
    } catch (error) {
        console.error('Error loading tournaments:', error);
        showStatus('‚ùå Erreur de chargement des tournois');
    }
}

function renderTournamentSelect() {
    const select = document.getElementById('tournament-select');
    
    if (!tournaments.length) {
        select.innerHTML = '<option value="">Aucun tournoi - cr√©ez-en un</option>';
        return;
    }
    
    select.innerHTML = tournaments.map(t => 
        `<option value="${t.id}">${t.name} (${formatDate(t.date_start) || 'Date non d√©finie'})</option>`
    ).join('');
}

document.getElementById('tournament-select').addEventListener('change', async (e) => {
    currentTournamentId = parseInt(e.target.value);
    await loadTournamentData();
});

document.getElementById('new-tournament-btn').addEventListener('click', async () => {
    const name = prompt('Nom du tournoi:');
    if (!name) return;
    
    const dateStart = prompt('Date de d√©but (YYYY-MM-DD):');
    const dateEnd = prompt('Date de fin (YYYY-MM-DD):');
    const location = prompt('Lieu:');
    
    try {
        const { data, error } = await supabase
            .from('tournaments')
            .insert({
                name,
                date_start: dateStart || null,
                date_end: dateEnd || null,
                location: location || null
            })
            .select()
            .single();
        
        if (error) throw error;
        
        showStatus('‚úÖ Tournoi cr√©√©');
        await loadTournaments();
        
        currentTournamentId = data.id;
        document.getElementById('tournament-select').value = currentTournamentId;
        await loadTournamentData();
    } catch (error) {
        console.error('Error creating tournament:', error);
        showStatus('‚ùå Erreur lors de la cr√©ation');
    }
});

document.getElementById('refresh-btn').addEventListener('click', async () => {
    showStatus('üîÑ Actualisation...');
    await loadTournamentData();
    showStatus('‚úÖ Actualis√©');
});

// ==================== WODS ====================
async function loadTournamentData() {
    if (!currentTournamentId) {
        wods = [];
        scores = [];
        renderWods();
        renderScores();
        return;
    }
    
    try {
        // Load WODs
        const { data: wodsData, error: wodsError } = await supabase
            .from('workouts')
            .select('*')
            .eq('tournament_id', currentTournamentId)
            .order('wod_number');
        
        if (wodsError) throw wodsError;
        wods = wodsData;
        
        // Load Scores
        const { data: scoresData, error: scoresError } = await supabase
            .from('scores')
            .select(`
                *,
                athletes(id, first_name, last_name, gender, level),
                workouts!inner(id, wod_number, wod_type, tournament_id),
                judges(id, name)
            `)
            .eq('workouts.tournament_id', currentTournamentId)
            .order('id');
        
        if (scoresError) throw scoresError;
        scores = scoresData;
        
        renderWods();
        renderScores();
    } catch (error) {
        console.error('Error loading tournament data:', error);
        showStatus('‚ùå Erreur de chargement des donn√©es');
    }
}

function renderWods() {
    const tbody = document.getElementById('wods-tbody');
    
    if (!wods.length) {
        tbody.innerHTML = `
            <tr>
                <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                    Aucun WOD. Ajoutez-en un ci-dessus!
                </td>
            </tr>
        `;
        return;
    }
    
    const typeEmojis = {
        'time': '‚è±Ô∏è For Time',
        'reps': 'üîÅ AMRAP',
        'weight': 'üèãÔ∏è Weight',
        'complex': 'üî• Complex'
    };
    
    tbody.innerHTML = wods.map(wod => `
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 font-semibold">WOD ${wod.wod_number}</td>
            <td class="px-4 py-3">${typeEmojis[wod.wod_type] || wod.wod_type}</td>
            <td class="px-4 py-3">${wod.description || '-'}</td>
            <td class="px-4 py-3 text-center">
                <button 
                    onclick="deleteWod(${wod.id})"
                    class="text-red-600 hover:text-red-800 font-medium"
                >
                    üóëÔ∏è Supprimer
                </button>
            </td>
        </tr>
    `).join('');
}

document.getElementById('add-wod-btn').addEventListener('click', async () => {
    if (!currentTournamentId) {
        alert('‚ö†Ô∏è Veuillez d\'abord s√©lectionner un tournoi');
        return;
    }
    
    const wodNumber = parseInt(document.getElementById('wod-number').value);
    const wodType = document.getElementById('wod-type').value;
    const description = document.getElementById('wod-description').value.trim();
    
    if (!wodNumber) {
        alert('‚ö†Ô∏è Le num√©ro du WOD est obligatoire');
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('workouts')
            .insert({
                tournament_id: currentTournamentId,
                wod_number: wodNumber,
                wod_type: wodType,
                description: description || null
            })
            .select()
            .single();
        
        if (error) throw error;
        
        showStatus('‚úÖ WOD ajout√©');
        
        // Clear form
        document.getElementById('wod-number').value = '';
        document.getElementById('wod-description').value = '';
        
        await loadTournamentData();
    } catch (error) {
        console.error('Error adding WOD:', error);
        showStatus('‚ùå Erreur lors de l\'ajout');
    }
});

async function deleteWod(id) {
    if (!confirm('Voulez-vous vraiment supprimer ce WOD ?')) return;
    
    try {
        const { error } = await supabase
            .from('workouts')
            .delete()
            .eq('id', id);
        
        if (error) throw error;
        
        showStatus('‚úÖ WOD supprim√©');
        await loadTournamentData();
    } catch (error) {
        console.error('Error deleting WOD:', error);
        showStatus('‚ùå Erreur lors de la suppression');
    }
}

// ==================== SCORES ====================
function renderScores() {
    const tbody = document.getElementById('results-tbody');
    
    if (!scores.length) {
        tbody.innerHTML = `
            <tr>
                <td colspan="4" class="px-4 py-8 text-center text-gray-400">
                    Aucun r√©sultat pour ce tournoi
                </td>
            </tr>
        `;
        return;
    }
    
    // Show last 50 results
    const recentScores = scores.slice(-50).reverse();
    
    tbody.innerHTML = recentScores.map(score => {
        const athlete = score.athletes;
        const workout = score.workouts;
        
        const athleteName = athlete ? `${athlete.first_name} ${athlete.last_name}` : 'Inconnu';
        const wodName = workout ? `WOD ${workout.wod_number}` : 'Inconnu';
        const resultValue = score.value_time || score.value_int || score.value_decimal || score.notes || '-';
        
        return `
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">${athleteName}</td>
            <td class="px-4 py-3">${wodName}</td>
            <td class="px-4 py-3 font-semibold">${resultValue}</td>
            <td class="px-4 py-3 text-center">
                <button 
                    onclick="deleteScore(${score.id})"
                    class="text-red-600 hover:text-red-800 font-medium"
                >
                    üóëÔ∏è Supprimer
                </button>
            </td>
        </tr>
        `;
    }).join('');
}

async function deleteScore(id) {
    if (!confirm('Voulez-vous vraiment supprimer ce r√©sultat ?')) return;
    
    try {
        const { error } = await supabase
            .from('scores')
            .delete()
            .eq('id', id);
        
        if (error) throw error;
        
        showStatus('‚úÖ R√©sultat supprim√©');
        await loadTournamentData();
    } catch (error) {
        console.error('Error deleting score:', error);
        showStatus('‚ùå Erreur lors de la suppression');
    }
}

// ==================== INITIALIZATION ====================
async function init() {
    showStatus('üîÑ Chargement...');
    
    try {
        await loadAthletes();
        await loadTournaments();
        showStatus('‚úÖ Pr√™t!', 1000);
    } catch (error) {
        console.error('Initialization error:', error);
        showStatus('‚ùå Erreur d\'initialisation');
    }
}

// Auto-focus password input
passwordInput.focus();
</script>

</body>
</html>
